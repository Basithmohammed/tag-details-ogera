<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OGERA Service</title>
    <link rel="icon" type="image/png" href="logo.jpeg">
    
    <!-- EmailJS -->
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

    <!-- Choices.js for searchable dropdown -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

    <script>
        (function () {
            emailjs.init("EL0iKkv9XdLt50uLZ");
        })();
    </script>

    <style>
        body {
            background: linear-gradient(135deg, #1f1f1f, #2c2c2c);
            min-height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        #salesForm {
            background: #2b2b2b;
            padding: 40px 35px;
            border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            min-width: 350px;
            max-width: 450px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 15px;
            color: #f0f0f0;
        }

        #salesForm h2 {
            text-align: center;
            color: #00c6ff;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        #salesForm label {
            font-weight: 600;
            color: #e0e0e0;
        }

        #salesForm select,
        #salesForm input,
        #salesForm textarea {
            padding: 12px 14px;
            border: 1px solid #555;
            border-radius: 8px;
            font-size: 1rem;
            background: #3a3a3a;
            color: #f0f0f0;
            outline: none;
        }

        #salesForm select:focus,
        #salesForm input:focus,
        #salesForm textarea:focus {
            border-color: #00c6ff;
            box-shadow: 0 0 8px rgba(0, 198, 255, 0.4);
        }

        #salesForm textarea {
            resize: none;
        }

        #salesForm button {
            padding: 12px 0;
            border: none;
            border-radius: 8px;
            background: #00c6ff;
            color: #1f1f1f;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        #salesForm button:hover {
            background: #00a0cc;
        }

        .choices__inner {
            color: #000 !important;
            background-color: #fff !important;
        }

        .choices__list--dropdown .choices__item--choice {
            color: #000 !important;
        }

        #salesPersonId,
        #productId,
        #dealerContact {
            background: #e0e0e0 !important;
            color: #000 !important;
        }
    </style>
</head>

<script>
    // Check if user is logged in
    const user = sessionStorage.getItem('loggedInUser');
    if (!user) {
        // Redirect to login page if not logged in
        window.location.href = 'login.html';
    } else {
        // Optional: Pre-fill Sales Person field if needed
        const salesPersonMap = { "Irshad": "1", "Shafeek Rahman": "2", "Sreejith P": "3", "Sunish Chacko": "4", "Vinod Kumar": "5", "Muhammed Shafeeque KB": "6", "Ashmil": "7", "Nandu P": "8" };
        const salesPersonIdMap = { "Irshad": "4004", "Shafeek Rahman": "4005", "Sreejith P": "4006", "Sunish Chacko": "4007", "Vinod Kumar": "4008", "Muhammed Shafeeque KB": "4009", "Ashmil": "4010", "Nandu P": "4011" };
        const selectElem = document.getElementById('salesPerson');

        if (selectElem) {
            selectElem.value = salesPersonMap[user];
            document.getElementById('salesPersonId').value = salesPersonIdMap[user];

            // Trigger change to populate dealer dropdown
            const event = new Event('change');
            selectElem.dispatchEvent(event);
        }
    }
</script>

<body>
    <form id="salesForm">
        <h2>SUBMIT TAG DETAILS</h2>

        <label for="salesPerson">Sales Person:</label>
        <select id="salesPerson" name="salesPerson" required>
            <option value="" disabled>Select Sales Person</option>
            <option value="1" data-id="4004">Irshad</option>
            <option value="2" data-id="4005">Shafeek Rahman</option>
            <option value="3" data-id="4006">Sreejith P</option>
            <option value="4" data-id="4007">Sunish Chacko</option>
            <option value="5" data-id="4008">Vinod Kumar</option>
            <option value="6" data-id="4009">Muhammed Shafeeque KB</option>
            <option value="7" data-id="4010">Ashmil</option>
            <option value="8" data-id="4011">Nandu P</option>
        </select>
        <input type="text" id="salesPersonId" name="salesPersonId" placeholder="Sales Person ID" readonly>

        <label for="product">Product:</label>
        <select id="product" name="product" required>
            <option value="" disabled selected>Select Product</option>
            <option value="A" data-id="OG9000PC3L">Aluminium Pressure Cooker 3L</option>
            <option value="B" data-id="OG9001PC5L">Aluminium Pressure Cooker 5L</option>
            <option value="C" data-id="OG9019PC7.5L">Aluminium Pressure Cooker 7.5L</option>
            <option value="D" data-id="OG9018PC10L">Aluminium Pressure Cooker 10L</option>
            <option value="E" data-id="OG9020PC2P">Aluminium Pressure Cooker Combo 2P</option>
            <option value="F" data-id="OG9021PC3P">Aluminium Pressure Cooker Combo 3P</option>
            <option value="G" data-id="OG9022PCS3L">Stainless Steel Pressure Cooker 3L</option>
            <option value="H" data-id="OG9023PCS5L">Stainless Steel Pressure Cooker 5L</option>
            <option value="I" data-id="OG9024PCI3">Aluminium Pressure Cooker Inner Lid 3L</option>
            <option value="J" data-id="OG9025PCI5">Aluminium Pressure Cooker Inner Lid 5L</option>

            <option value="K" data-id="OG3001GC">2 Burner Gas Stove - Evoflame series</option>
            <option value="L" data-id="OG3002GC">3 Burner Gas Stove - Evoflame series</option>
            <option value="M" data-id="OG3003GC">2 Burner Gas Stove - Flamora series</option>
            <option value="N" data-id="OG3004GC">3 Burner Gas Stove - Flamora series</option>
            <option value="O" data-id="OG3000GC">4 Burner Gas Stove - Flamora series</option>
            <option value="OA" data-id="OG3005GC">3 Burner Gas Stove - Triaura</option>
        
            <option value="P" data-id="OG8000IC">Induction Cooktop -Touch</option>
            <option value="Q" data-id="OG8001IC">Induction Cooktop -Button</option>

            <option value="R" data-id="OG1500EK">Electric Kettle -1500</option>
            <option value="S" data-id="OG1501EK">Electric Kettle -1501</option>
            <option value="T" data-id="OG1502EK">Electric Kettle -1502</option>
            <option value="V" data-id="OG1503EK">SS Electric Kettle -1503</option>
            <option value="U" data-id="OG1504EK">SS Electric Kettle -1504</option>

            <option value="W" data-id="OG101D1">Dry Iron - 2KG</option>
            <option value="X" data-id="OG100D1">Dry Iron - 1.5KG</option>
            <option value="Y" data-id="OG102D1">Dry Iron - Light Weight</option>
            <option value="YA" data-id="OG103D1">Dry Iron - Light Weight Silka</option>
            <option value="YB" data-id="OG105D1">Dry Iron - Light Weight Dry Leaf</option>
            <option value="YC" data-id="OG104D1">Dry Iron - Medium Weight Loomlite</option>
            

            <option value="Z" data-id="OG7000NB">Mixer Blender - Red</option>
            <option value="AA" data-id="OG7000NB">Mixer Blender - Sliver</option>
            <option value="AB" data-id="OG7000NB">Mixer Blender - Purple</option>

            <option value="AC" data-id="OG9002TW">Non Stick Dosa Tawa -26cm</option>
            <option value="AD" data-id="OG9003TW">Non Stick Dosa Tawa -28cm</option>
            <option value="AE" data-id="OG9004FP">Non Stick Frypan -24cm</option>
            <option value="AF" data-id="OG9005FP">Non Stick Frypan -26cm</option>
            <option value="AG" data-id="OG9006KD">Non Stick Kadai with Glass Lid</option>
            <option value="AH" data-id="OG9007PT">Non Stick Pathiri Tawa-Round</option>
            <option value="AI" data-id="OG9008PT">Non Stick Pathiri Tawa-Square</option>
            <option value="AJ" data-id="OG9009CS9">Non Stick Biriyani Pot 9 PCS</option>

            <option value="AK" data-id="OG9010BP-4.5">Biriyani Pot with Glass Lid-4.5L</option>
            <option value="AL" data-id="OG9011BP-6">Biriyani Pot with Glass Lid-6L</option>
            <option value="AM" data-id="OG9012BP-8">Biriyani Pot with Glass Lid-8L</option>
            <option value="AN" data-id="OG9013BP-10">Biriyani Pot with Glass Lid-10L</option>
            <option value="AMA" data-id="OG9029BP8">Biriyani Pot with Glass Lid-Luxe BP8</option>
            <option value="ANA" data-id="OG9028BP10">Biriyani Pot with Glass Lid-Luxe BP10</option>

            <option value="AO" data-id="OG9014SP">Sauce Pan</option>
            <option value="AP" data-id="OG9015PP">Paniyarakkal</option>
            <option value="AQ" data-id="OG9016KTF">Kadai Tawa Frypan - 9016</option>
            <option value="AR" data-id="OG9017KTF">Kadai Tawa Frypan - 9017</option>
            <option value="AS" data-id="OG9026AC">Appachatty</option>
            <option value="AT" data-id="OG9027AC">Prime Appachatty</option>
            
            

        </select>
        <input type="text" id="productId" name="productId" placeholder="Product ID" readonly>

        <label for="productSerial">Product Serial Number:</label>
        <input type="text" id="productSerial" name="productSerial" placeholder="Enter Serial Number">

        <label for="dealerName">Dealer Name:</label>
        <select id="dealerName" name="dealerName" required>
            <option value="" disabled selected>Select Dealer</option>
        </select>

        <label for="dealerContact">Dealer Contact Number:</label>
        <input type="tel" id="dealerContact" name="dealerContact" required pattern="[0-9]{10}" placeholder="Dealer contact will appear here" readonly>

        <label for="complaint">Complaint:</label>
        <textarea id="complaint" name="complaint" rows="3" placeholder="Enter complaint details here..." required></textarea>

        <label for="complaintDate">Complaint Date:</label>
        <input type="date" id="complaintDate" name="complaintDate" required>

        <button type="submit">Submit</button>
    </form>

    <script>
        const salesPersonDealers = {
            "1": [
                { name: "4Yu Supermarket Chattiparmbil", contact: "9745600701", email: "dealerA1@email.com" },
                { name: "AAK HYPER MARKET TIRUR", contact: "9400330553", email: "dealerA2@email.com" },
                { name: "Aishwarya Metals, Kondotty", contact: "9895107127", email: "dealerA1@email.com" },
                { name: "Aishwarya Supermarket, Pulikkal", contact: "8281848356", email: "dealerA2@email.com" },
                { name: "Akam Home Appliances. EDAKKARA", contact: "9048812818", email: "dealerA1@email.com" },
                { name: "AL AMEEN HOME CENTRE", contact: "9846206951", email: "dealerA2@email.com" },
                { name: "Al Ghazali Pathrapura. Kondotty", contact: "9495306100", email: "dealerA1@email.com" },
                { name: "Alfa Appliances. Areekode", contact: "8547411276", email: "dealerA2@email.com" },
                { name: "ANSAS HOME LAND", contact: "9446949479", email: "" },
                { name: "Arafa Home Needs. EKKAPARAMBA", contact: "9048793031", email: "dealerA1@email.com" },
                { name: "Arafa Store.Morayur", contact: "9388825351", email: "dealerA2@email.com" },
                { name: "ASAS HOUSE LAND", contact: "7034948969", email: "dealerA1@email.com" },
                { name: "BHANUSHA AGENCIES, CHELARI", contact: "9846543759", email: "dealerA2@email.com" },
                { name: "Bharath Home Needs.AIKKARAPPADI", contact: "9847973847", email: "dealerA1@email.com" },
                { name: "BISMI HOME NEEDS", contact: "8590522831", email: "dealerA2@email.com" },
                { name: "BRK Home Needs Trippanachi", contact: "8089352010", email: "dealerA1@email.com" },
                { name: "Brothers Home Appliances,,mooripaadam", contact: "9567265736", email: "dealerA2@email.com" },
                { name: "Budget Home Needs,Pookkoottumpadam", contact: "9447681490", email: "" }
            ],
            "2": [
                { name: "PAYYOLI Store Payyoli", contact: "9847413559", email: "dealerB1@email.com" }
            ],
            "3": [
                { name: "ADUKKALA KITCHEN APPLIANCE", contact: "9744310030", email: "dealerC1@email.com" },
                { name: "AISHWARYA STORE AND GIFT", contact: "9447688626", email: "dealerC2@email.com" }
            ],
            "4": [
                { name: "BLUE MART SUPERMARKET", contact: "7907161467", email: "dealerC1@email.com" },
                { name: "CP HOME CENTRE NILAMBUR", contact: "9846238925", email: "dealerC2@email.com" }
            ],
            "5": [
                { name: "APPASONS ELECTRICS & APPLIANCE", contact: "04962522885", email: "dealerC1@email.com" },
                { name: "BADUSHA HYPERMARKET", contact: "9846892891", email: "dealerC2@email.com" },
                { name: "LAVANYA E-MART BALUSSERY", contact: "9645404042", email: "dealerC1@email.com" },
            ],
            "6": [
                { name: "GRAHALAKSHMI PULPALLY WAYANAD", contact: "9061157573", email: "dealerC1@email.com" },
                { name: "LULU SUPERMARKET ERUMAD", contact: "9489137707", email: "dealerC2@email.com" },
                { name: "MARY MATHA ELECTRICALS ERUMAD", contact: "9940848856", email: "dealerC1@email.com" },
                { name: "METTAL SPOT BATHERY", contact: "9605288512"},
                { name: "MPC ELECTRONICS MEPPADI", contact: "8590032728"},
                { name: "NP STORE PANAMARAM WAYANAD", contact: "9544553718"},
                { name: "RAJADHANI HOME CENTER WAYANAD", contact: "9747748011"},
                { name: "RANI METALS MEENANGADI", contact: "9895577628"},
                { name: "SAYONA ELECTRONICS MEENANGADI", contact: "8547072050"},
                { name: "STOVE CENTER BATHERY", contact: "9846258470"},
                { name: "VARNAM FANCY VADUVANJAL", contact: "9447316950"},
            ],
            "7": [
                { name: "A", contact: "04962522885", email: "dealerC1@email.com" },
                { name: "B", contact: "9846892891", email: "dealerC2@email.com" },
                { name: "C", contact: "9645404042", email: "dealerC1@email.com" },
            ],
            "8": [
                { name: "A", contact: "04962522885", email: "dealerC1@email.com" },
                { name: "B", contact: "9846892891", email: "dealerC2@email.com" },
                { name: "C", contact: "9645404042", email: "dealerC1@email.com" },
            ],

        };

        const salesPersonEmails = {
            "1": "irshad@ogeraglobal.com",
            "2": "shafeek.r@ogeraglobal.com",
            "3": "sreejith@ogeraglobal.com",
            "4": "sunish.c@ogeraglobal.com",
            "5": "vinod.kumar@ogeraglobal.com",
            "6": "m.shafeeque@ogeraglobal.com",
            "7": "ashmil@ogeraglobal.com",
            "8": "nandu@ogeraglobal.com",
        };

        const salesHeadEmail = "service@ogeraglobal.com";

        document.addEventListener('DOMContentLoaded', function () {
            window.dealerChoices = new Choices('#dealerName', { searchEnabled: true, itemSelectText: '', shouldSort: false });

            // 🟢 Set today's date automatically
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('complaintDate').value = today;

            // Auto-fill Sales Person from login
            const user = sessionStorage.getItem('loggedInUser');
            if (user) {
                const salesPersonMap = { "Irshad": "1", "Shafeek Rahman": "2", "Sreejith P": "3", "Sunish Chacko": "4", "Vinod Kumar": "5", "Muhammed Shafeeque KB": "6" ,"Ashmil": "7", "Nandu P": "8" };
                const salesPersonIdMap = { "Irshad": "4004", "Shafeek Rahman": "4005", "Sreejith P": "4006", "Sunish Chacko": "4007", "Vinod Kumar": "4008", "Muhammed Shafeeque KB": "4009", "Ashmil": "4010", "Nandu P": "4011" };
                const salesPersonSelect = document.getElementById('salesPerson');
                salesPersonSelect.value = salesPersonMap[user];
                document.getElementById('salesPersonId').value = salesPersonIdMap[user];

                // Populate dealers automatically
                const dealers = salesPersonDealers[salesPersonSelect.value] || [];
                window.dealerChoices.clearChoices();
                window.dealerChoices.setChoices(
                    dealers.map((dealer, idx) => ({
                        value: idx.toString(),
                        label: dealer.name,
                        customProperties: { contact: dealer.contact }
                    })), 'value', 'label', false
                );
            }
        });

        document.getElementById('salesPerson').addEventListener('change', function () {
            const selectedId = this.options[this.selectedIndex].getAttribute('data-id');
            document.getElementById('salesPersonId').value = selectedId;

            const dealers = salesPersonDealers[this.value] || [];
            window.dealerChoices.clearChoices();
            window.dealerChoices.setChoices(
                dealers.map((dealer, idx) => ({
                    value: idx.toString(),
                    label: dealer.name,
                    customProperties: { contact: dealer.contact }
                })), 'value', 'label', false
            );
            document.getElementById('dealerContact').value = '';
        });

        document.getElementById('product').addEventListener('change', function () {
            document.getElementById('productId').value = this.options[this.selectedIndex].getAttribute('data-id') || '';
        });

        document.getElementById('dealerName').addEventListener('change', function () {
            const selectedIdx = this.value;
            const salesPersonValue = document.getElementById('salesPerson').value;
            const selectedDealer = (salesPersonDealers[salesPersonValue] || [])[selectedIdx];
            document.getElementById('dealerContact').value = selectedDealer ? selectedDealer.contact : '';
        });

        document.getElementById('salesForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const autoCode = 'TAG-' + Math.floor(100000 + Math.random() * 900000);

            const salesPersonSelect = document.getElementById('salesPerson');
            const salesPersonId = document.getElementById('salesPersonId').value;
            const salesPersonName = salesPersonSelect.options[salesPersonSelect.selectedIndex].text;
            const salesPersonEmail = salesPersonEmails[salesPersonSelect.value];

            const productSelect = document.getElementById('product');
            const productId = document.getElementById('productId').value;
            const productName = productSelect.options[productSelect.selectedIndex].text;
            const productSerial = document.getElementById('productSerial').value;

            const dealerSelect = document.getElementById('dealerName');
            const dealerName = dealerSelect.options[dealerSelect.selectedIndex].text;
            const dealerContact = document.getElementById('dealerContact').value;

            const complaint = document.getElementById('complaint').value;
            const complaintDate = document.getElementById('complaintDate').value;

            const templateParams = {
                sales_person_name: salesPersonName,
                sales_person_id: salesPersonId,
                product_name: productName,
                product_id: productId,
                product_serial: productSerial,
                dealer_name: dealerName,
                dealer_contact: dealerContact,
                complaint: complaint,
                complaint_date: complaintDate,
                auto_code: autoCode
            };

            // Email to Sales Person
            emailjs.send('service_tj3qg0s', 'template_e59692j', { ...templateParams, to_email: salesPersonEmail })
                .then(() => {
                    // Email to Sales Head
                    emailjs.send('service_tj3qg0s', 'template_e59692j', { ...templateParams, to_email: salesHeadEmail })
                        .then(() => {
                            alert('Form submitted and emails sent!');
                            document.getElementById('salesForm').reset();
                            document.getElementById('salesPersonId').value = '';
                            document.getElementById('productId').value = '';
                            document.getElementById('dealerContact').value = '';
                            window.dealerChoices.clearChoices();
                        })
                        .catch(error => alert('Failed to send email to sales head: ' + error.text));
                })
                .catch(error => alert('Failed to send email to sales person: ' + error.text));
        });
    </script>
</body>
</html>
